// Translations for multi-language support
const translations = {
    ja: {
        // Navigation
        'nav-home': 'ãƒ›ãƒ¼ãƒ ',
        'nav-services': 'ã‚µãƒ¼ãƒ“ã‚¹',
        'nav-process': 'å·¥äº‹ã®æµã‚Œ',
        'nav-gallery': 'æ–½å·¥ç¾å ´',
        'nav-company': 'ä¼šç¤¾æ¦‚è¦',
        'nav-contact': 'ãŠå•ã„åˆã‚ã›',
        
        // Hero Section
        'hero-title': 'æ¹˜å—ãƒ»æ¨ªæµœã®è§£ä½“å·¥äº‹å°‚é–€',
        'hero-subtitle': 'æ—¥ç³»è§£ä½“å·¥æ¥­æ ªå¼ä¼šç¤¾',
        'hero-description': 'å®‰å…¨ã§ç¢ºå®Ÿãªè§£ä½“å·¥äº‹ã‚’ãŠç´„æŸã—ã¾ã™ã€‚æˆ¸å»ºè§£ä½“ã€ç«äº‹è§£ä½“ã€ç”£å»ƒå‡¦ç†ã¾ã§å¯¾å¿œã€‚',
        'hero-cta': 'ç„¡æ–™è¦‹ç©ã‚‚ã‚Š',
        
        // Services
        'services-title': 'ã‚µãƒ¼ãƒ“ã‚¹å†…å®¹',
        'service-1-title': 'æˆ¸å»ºè§£ä½“å·¥äº‹',
        'service-1-desc': 'ä¸€èˆ¬ä½å®…ã®è§£ä½“å·¥äº‹',
        'service-2-title': 'ç«äº‹è§£ä½“å·¥äº‹',
        'service-2-desc': 'ç«ç½è¢«å®³å»ºç‰©ã®è§£ä½“',
        'service-3-title': 'ç”£å»ƒå‡¦ç†',
        'service-3-desc': 'ç”£æ¥­å»ƒæ£„ç‰©ã®é©æ­£å‡¦ç†',
        'service-4-title': 'ã‚«ãƒ¼ãƒãƒ¼ãƒˆæ’¤åŽ»',
        'service-4-desc': 'ã‚«ãƒ¼ãƒãƒ¼ãƒˆãƒ»è»Šåº«ã®æ’¤åŽ»',
        'service-5-title': 'ã‚´ãƒŸæ’¤åŽ»',
        'service-5-desc': 'ä¸è¦å“ãƒ»ç²—å¤§ã‚´ãƒŸã®æ’¤åŽ»',
        
        // Process
        'process-title': 'å·¥äº‹ã®æµã‚Œ',
        'process-description': 'è§£ä½“å·¥äº‹ã®è©³ç´°ãªæµã‚Œã«ã¤ã„ã¦ã¯ã€ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„',
        'process-link': 'ã“ã¡ã‚‰ã‚’ã”è¦§ãã ã•ã„',
        
        // Gallery
        'gallery-title': 'æ–½å·¥ç¾å ´',
        'gallery-item-1': 'æˆ¸å»ºè§£ä½“å·¥äº‹',
        'gallery-item-2': 'ç«äº‹è§£ä½“å·¥äº‹',
        'gallery-item-3': 'ç”£å»ƒå‡¦ç†',
        'gallery-item-4': 'é‡æ©Ÿä½œæ¥­',
        'gallery-item-5': 'ç¾å ´æ¸…æŽƒ',
        'gallery-item-6': 'å®‰å…¨ç®¡ç†',
        
        // Company
        'company-title': 'ä¼šç¤¾æ¦‚è¦',
        'company-name': 'æ—¥ç³»è§£ä½“å·¥æ¥­æ ªå¼ä¼šç¤¾',
        'company-phone': '0467-38-8842',
        'company-fax': '0467-38-8843',
        'company-email': 'info@nikkei-kaitai.com',
        'company-license': 'è§£ä½“å·¥äº‹æ¥­è€…ç™»éŒ²ç•ªå·: ç¥žå¥ˆå·çœŒ(ç™»-29ï¼‰ç¬¬1842å· æ±äº¬éƒ½(ç™»-30ï¼‰ç¬¬3481å·',
        
        // Contact
        'contact-title': 'ãŠå•ã„åˆã‚ã›',
        'contact-description': 'ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„',
        'contact-phone': 'ãŠé›»è©±ã§ã®ãŠå•ã„åˆã‚ã›',
        'contact-form': 'ãŠå•ã„åˆã‚ã›ãƒ•ã‚©ãƒ¼ãƒ ',
        
        // Footer
        'footer-services': 'ã‚µãƒ¼ãƒ“ã‚¹',
        'footer-areas': 'å¯¾å¿œã‚¨ãƒªã‚¢',
        'footer-company': 'ä¼šç¤¾æƒ…å ±',
        'footer-rights': 'All rights reserved.',
        
        // Process Page
        'process-hero-title': 'è§£ä½“å·¥äº‹ã®æµã‚Œ',
        'process-hero-subtitle': 'ãŠè¦‹ç©ã‚Šã‹ã‚‰å·¥äº‹å®Œäº†ã¾ã§ã€å®‰å¿ƒã®7ã‚¹ãƒ†ãƒƒãƒ—ã§é€²ã‚ã¾ã™',
        'process-breadcrumb': 'ãƒ›ãƒ¼ãƒ  > å·¥äº‹ã®æµã‚Œ',
        'process-overview-title': 'å·¥äº‹ã®æµã‚Œæ¦‚è¦',
        'process-overview-desc': 'è§£ä½“å·¥äº‹ã¯è¤‡é›‘ãªæ‰‹ç¶šããŒå¿…è¦ã§ã™ãŒã€å½“ç¤¾ãŒè²¬ä»»ã‚’æŒã£ã¦å…¨ã¦ã®å·¥ç¨‹ã‚’ç®¡ç†ã„ãŸã—ã¾ã™ã€‚ãŠå®¢æ§˜ã«ã¯æœ€å°é™ã®ã”è² æ‹…ã§ã€å®‰å¿ƒã—ã¦å·¥äº‹ã‚’é€²ã‚ã¦ã„ãŸã ã‘ã¾ã™ã€‚',
        
        // Language Selector
        'lang-ja': 'æ—¥æœ¬èªž',
        'lang-pt': 'PortuguÃªs',
        'lang-en': 'English'
    },
    
    pt: {
        // Navigation
        'nav-home': 'InÃ­cio',
        'nav-services': 'ServiÃ§os',
        'nav-process': 'Processo',
        'nav-gallery': 'Obras',
        'nav-company': 'Empresa',
        'nav-contact': 'Contato',
        
        // Hero Section
        'hero-title': 'Especialista em DemoliÃ§Ã£o em Shonan e Yokohama',
        'hero-subtitle': 'Nikkei DemoliÃ§Ã£o Industrial Ltda.',
        'hero-description': 'Garantimos demoliÃ§Ã£o segura e confiÃ¡vel. Atendemos demoliÃ§Ã£o residencial, pÃ³s-incÃªndio e processamento de resÃ­duos industriais.',
        'hero-cta': 'OrÃ§amento Gratuito',
        
        // Services
        'services-title': 'Nossos ServiÃ§os',
        'service-1-title': 'DemoliÃ§Ã£o Residencial',
        'service-1-desc': 'DemoliÃ§Ã£o de casas residenciais',
        'service-2-title': 'DemoliÃ§Ã£o PÃ³s-IncÃªndio',
        'service-2-desc': 'DemoliÃ§Ã£o de edifÃ­cios danificados por incÃªndio',
        'service-3-title': 'Processamento de ResÃ­duos',
        'service-3-desc': 'Processamento adequado de resÃ­duos industriais',
        'service-4-title': 'RemoÃ§Ã£o de Carport',
        'service-4-desc': 'RemoÃ§Ã£o de carports e garagens',
        'service-5-title': 'RemoÃ§Ã£o de Lixo',
        'service-5-desc': 'RemoÃ§Ã£o de itens desnecessÃ¡rios e lixo volumoso',
        
        // Process
        'process-title': 'Processo de DemoliÃ§Ã£o',
        'process-description': 'Para detalhes do processo de demoliÃ§Ã£o, consulte',
        'process-link': 'aqui',
        
        // Gallery
        'gallery-title': 'Obras Realizadas',
        'gallery-item-1': 'DemoliÃ§Ã£o Residencial',
        'gallery-item-2': 'DemoliÃ§Ã£o PÃ³s-IncÃªndio',
        'gallery-item-3': 'Processamento de ResÃ­duos',
        'gallery-item-4': 'OperaÃ§Ã£o de MÃ¡quinas',
        'gallery-item-5': 'Limpeza do Local',
        'gallery-item-6': 'GestÃ£o de SeguranÃ§a',
        
        // Company
        'company-title': 'Sobre a Empresa',
        'company-name': 'Nikkei DemoliÃ§Ã£o Industrial Ltda.',
        'company-phone': '0467-38-8842',
        'company-fax': '0467-38-8843',
        'company-email': 'info@nikkei-kaitai.com',
        'company-license': 'Registro de Empresa de DemoliÃ§Ã£o: Kanagawa (ç™»-29) No.1842 TÃ³quio (ç™»-30) No.3481',
        
        // Contact
        'contact-title': 'Contato',
        'contact-description': 'Entre em contato conosco',
        'contact-phone': 'Contato por Telefone',
        'contact-form': 'FormulÃ¡rio de Contato',
        
        // Footer
        'footer-services': 'ServiÃ§os',
        'footer-areas': 'Ãreas de AtuaÃ§Ã£o',
        'footer-company': 'InformaÃ§Ãµes da Empresa',
        'footer-rights': 'Todos os direitos reservados.',
        
        // Process Page
        'process-hero-title': 'Processo de DemoliÃ§Ã£o',
        'process-hero-subtitle': 'Do orÃ§amento Ã  conclusÃ£o da obra, em 7 etapas seguras',
        'process-breadcrumb': 'InÃ­cio > Processo',
        'process-overview-title': 'VisÃ£o Geral do Processo',
        'process-overview-desc': 'A demoliÃ§Ã£o requer procedimentos complexos, mas nossa empresa gerencia responsavelmente todos os processos. Garantimos o mÃ­nimo de incÃ´modo para nossos clientes.',
        
        // Language Selector
        'lang-ja': 'æ—¥æœ¬èªž',
        'lang-pt': 'PortuguÃªs',
        'lang-en': 'English'
    },
    
    en: {
        // Navigation
        'nav-home': 'Home',
        'nav-services': 'Services',
        'nav-process': 'Process',
        'nav-gallery': 'Gallery',
        'nav-company': 'Company',
        'nav-contact': 'Contact',
        
        // Hero Section
        'hero-title': 'Demolition Specialist in Shonan & Yokohama',
        'hero-subtitle': 'Nikkei Demolition Industrial Co., Ltd.',
        'hero-description': 'We guarantee safe and reliable demolition work. We handle residential demolition, post-fire demolition, and industrial waste processing.',
        'hero-cta': 'Free Estimate',
        
        // Services
        'services-title': 'Our Services',
        'service-1-title': 'Residential Demolition',
        'service-1-desc': 'House demolition work',
        'service-2-title': 'Post-Fire Demolition',
        'service-2-desc': 'Demolition of fire-damaged buildings',
        'service-3-title': 'Waste Processing',
        'service-3-desc': 'Proper industrial waste processing',
        'service-4-title': 'Carport Removal',
        'service-4-desc': 'Carport and garage removal',
        'service-5-title': 'Waste Removal',
        'service-5-desc': 'Unnecessary items and bulky waste removal',
        
        // Process
        'process-title': 'Demolition Process',
        'process-description': 'For detailed demolition process information, please see',
        'process-link': 'here',
        
        // Gallery
        'gallery-title': 'Construction Sites',
        'gallery-item-1': 'Residential Demolition',
        'gallery-item-2': 'Post-Fire Demolition',
        'gallery-item-3': 'Waste Processing',
        'gallery-item-4': 'Heavy Machinery Operation',
        'gallery-item-5': 'Site Cleanup',
        'gallery-item-6': 'Safety Management',
        
        // Company
        'company-title': 'Company Information',
        'company-name': 'Nikkei Demolition Industrial Co., Ltd.',
        'company-phone': '0467-38-8842',
        'company-fax': '0467-38-8843',
        'company-email': 'info@nikkei-kaitai.com',
        'company-license': 'Demolition Business Registration: Kanagawa (ç™»-29) No.1842 Tokyo (ç™»-30) No.3481',
        
        // Contact
        'contact-title': 'Contact Us',
        'contact-description': 'Please feel free to contact us',
        'contact-phone': 'Phone Contact',
        'contact-form': 'Contact Form',
        
        // Footer
        'footer-services': 'Services',
        'footer-areas': 'Service Areas',
        'footer-company': 'Company Information',
        'footer-rights': 'All rights reserved.',
        
        // Process Page
        'process-hero-title': 'Demolition Process',
        'process-hero-subtitle': 'From estimate to completion, in 7 safe steps',
        'process-breadcrumb': 'Home > Process',
        'process-overview-title': 'Process Overview',
        'process-overview-desc': 'Demolition requires complex procedures, but our company manages all processes responsibly. We ensure minimal inconvenience for our clients.',
        
        // Language Selector
        'lang-ja': 'æ—¥æœ¬èªž',
        'lang-pt': 'PortuguÃªs',
        'lang-en': 'English'
    }
};

// Language management functions
class LanguageManager {
    constructor() {
        this.currentLanguage = this.getStoredLanguage() || 'ja';
        this.init();
    }
    
    init() {
        this.applyLanguage(this.currentLanguage);
        this.bindEvents();
    }
    
    getStoredLanguage() {
        return localStorage.getItem('selectedLanguage');
    }
    
    setStoredLanguage(lang) {
        localStorage.setItem('selectedLanguage', lang);
    }
    
    createLanguageSelector() {
        console.log('Creating language selector...');
        const navMenu = document.querySelector('.nav-menu');
        console.log('Nav menu found:', navMenu);
        
        if (!navMenu) {
            console.error('Nav menu not found!');
            return;
        }
        
        const languageSelector = document.createElement('li');
        languageSelector.className = 'nav-item language-selector';
        languageSelector.innerHTML = `
            <div class="language-dropdown">
                <button class="language-btn" aria-label="Select Language">
                    <i class="fas fa-globe"></i>
                    <span class="current-lang">${this.getCurrentLanguageName()}</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <ul class="language-menu">
                    <li><a href="#" data-lang="ja" class="language-option ${this.currentLanguage === 'ja' ? 'active' : ''}">
                        <span class="flag">ðŸ‡¯ðŸ‡µ</span> ${translations[this.currentLanguage]['lang-ja']}
                    </a></li>
                    <li><a href="#" data-lang="pt" class="language-option ${this.currentLanguage === 'pt' ? 'active' : ''}">
                        <span class="flag">ðŸ‡§ðŸ‡·</span> ${translations[this.currentLanguage]['lang-pt']}
                    </a></li>
                    <li><a href="#" data-lang="en" class="language-option ${this.currentLanguage === 'en' ? 'active' : ''}">
                        <span class="flag">ðŸ‡ºðŸ‡¸</span> ${translations[this.currentLanguage]['lang-en']}
                    </a></li>
                </ul>
            </div>
        `;
        
        navMenu.appendChild(languageSelector);
        console.log('Language selector added to nav menu');
    }
    
    getCurrentLanguageName() {
        const names = {
            'ja': 'æ—¥æœ¬èªž',
            'pt': 'PT',
            'en': 'EN'
        };
        return names[this.currentLanguage] || 'æ—¥æœ¬èªž';
    }
    
    bindEvents() {
        // Language selector events
        document.addEventListener('click', (e) => {
            if (e.target.closest('.language-btn')) {
                e.preventDefault();
                const dropdown = e.target.closest('.language-dropdown');
                dropdown.classList.toggle('active');
            }
            
            if (e.target.closest('.language-option')) {
                e.preventDefault();
                const lang = e.target.closest('.language-option').dataset.lang;
                this.changeLanguage(lang);
            }
            
            // Close dropdown when clicking outside
            if (!e.target.closest('.language-dropdown')) {
                document.querySelectorAll('.language-dropdown').forEach(dropdown => {
                    dropdown.classList.remove('active');
                });
            }
        });
    }
    
    changeLanguage(lang) {
        if (lang === this.currentLanguage) return;
        
        this.currentLanguage = lang;
        this.setStoredLanguage(lang);
        this.applyLanguage(lang);
        this.updateLanguageSelector();
        
        // Close dropdown
        document.querySelectorAll('.language-dropdown').forEach(dropdown => {
            dropdown.classList.remove('active');
        });
    }
    
    applyLanguage(lang) {
        const elements = document.querySelectorAll('[data-translate]');
        elements.forEach(element => {
            const key = element.getAttribute('data-translate');
            if (translations[lang] && translations[lang][key]) {
                element.textContent = translations[lang][key];
            }
        });
        
        // Update page title and meta description
        this.updatePageMeta(lang);
    }
    
    updatePageMeta(lang) {
        const titles = {
            'ja': 'æ¹˜å— æ¨ªæµœã®è§£ä½“å·¥äº‹ã¯æ—¥ç³»è§£ä½“å·¥æ¥­æ ªå¼ä¼šç¤¾ã¸',
            'pt': 'DemoliÃ§Ã£o em Shonan e Yokohama - Nikkei DemoliÃ§Ã£o Industrial',
            'en': 'Demolition in Shonan & Yokohama - Nikkei Demolition Industrial'
        };
        
        const descriptions = {
            'ja': 'å®‰å…¨ã§ç¢ºå®Ÿãªè§£ä½“å·¥äº‹ã‚’ãŠç´„æŸã—ã¾ã™ã€‚æˆ¸å»ºè§£ä½“ã€ç«äº‹è§£ä½“ã€ç”£å»ƒå‡¦ç†ã¾ã§å¯¾å¿œã€‚',
            'pt': 'Garantimos demoliÃ§Ã£o segura e confiÃ¡vel. Atendemos demoliÃ§Ã£o residencial, pÃ³s-incÃªndio e processamento de resÃ­duos.',
            'en': 'We guarantee safe and reliable demolition work. We handle residential demolition, post-fire demolition, and waste processing.'
        };
        
        if (titles[lang]) {
            document.title = titles[lang];
        }
        
        const metaDescription = document.querySelector('meta[name="description"]');
        if (metaDescription && descriptions[lang]) {
            metaDescription.setAttribute('content', descriptions[lang]);
        }
    }
    
    updateLanguageSelector() {
        const currentLangSpan = document.querySelector('.current-lang');
        if (currentLangSpan) {
            currentLangSpan.textContent = this.getCurrentLanguageName();
        }
        
        // Update active state
        document.querySelectorAll('.language-option').forEach(option => {
            option.classList.remove('active');
            if (option.dataset.lang === this.currentLanguage) {
                option.classList.add('active');
            }
        });
    }
}

// Initialize language manager when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing language manager...');
    try {
        new LanguageManager();
        console.log('Language manager initialized successfully');
    } catch (error) {
        console.error('Error initializing language manager:', error);
    }
});

// Fallback initialization if DOMContentLoaded already fired
if (document.readyState === 'loading') {
    // DOM is still loading, wait for DOMContentLoaded
} else {
    // DOM is already loaded
    console.log('DOM already loaded, initializing language manager immediately...');
    try {
        new LanguageManager();
        console.log('Language manager initialized successfully (immediate)');
    } catch (error) {
        console.error('Error initializing language manager (immediate):', error);
    }
}
