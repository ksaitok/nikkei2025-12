// Translations for multi-language support
const translations = {
    ja: {
        // Navigation
        'nav-home': 'ホーム',
        'nav-services': 'サービス',
        'nav-process': '工事の流れ',
        'nav-gallery': '施工現場',
        'nav-company': '会社概要',
        'nav-contact': 'お問い合わせ',
        
        // Hero Section
        'hero-title': '湘南・横浜の解体工事専門',
        'hero-subtitle': '日系解体工業株式会社',
        'hero-description': '安全で確実な解体工事をお約束します。戸建解体、火事解体、産廃処理まで対応。',
        'hero-cta': '無料見積もり',
        
        // Services
        'services-title': 'サービス内容',
        'service-1-title': '戸建解体工事',
        'service-1-desc': '一般住宅の解体工事',
        'service-2-title': '火事解体工事',
        'service-2-desc': '火災被害建物の解体',
        'service-3-title': '産廃処理',
        'service-3-desc': '産業廃棄物の適正処理',
        'service-4-title': 'カーポート撤去',
        'service-4-desc': 'カーポート・車庫の撤去',
        'service-5-title': 'ゴミ撤去',
        'service-5-desc': '不要品・粗大ゴミの撤去',
        
        // Process
        'process-title': '工事の流れ',
        'process-description': '解体工事の詳細な流れについては、こちらをご覧ください',
        'process-link': 'こちらをご覧ください',
        
        // Gallery
        'gallery-title': '施工現場',
        'gallery-item-1': '戸建解体工事',
        'gallery-item-2': '火事解体工事',
        'gallery-item-3': '産廃処理',
        'gallery-item-4': '重機作業',
        'gallery-item-5': '現場清掃',
        'gallery-item-6': '安全管理',
        
        // Company
        'company-title': '会社概要',
        'company-name': '日系解体工業株式会社',
        'company-phone': '0467-38-8842',
        'company-fax': '0467-38-8843',
        'company-email': 'info@nikkei-kaitai.com',
        'company-license': '解体工事業者登録番号: 神奈川県(登-29）第1842号 東京都(登-30）第3481号',
        
        // Contact
        'contact-title': 'お問い合わせ',
        'contact-description': 'お気軽にお問い合わせください',
        'contact-phone': 'お電話でのお問い合わせ',
        'contact-form': 'お問い合わせフォーム',
        
        // Footer
        'footer-services': 'サービス',
        'footer-areas': '対応エリア',
        'footer-company': '会社情報',
        'footer-rights': 'All rights reserved.',
        
        // Process Page
        'process-hero-title': '解体工事の流れ',
        'process-hero-subtitle': 'お見積りから工事完了まで、安心の7ステップで進めます',
        'process-breadcrumb': 'ホーム > 工事の流れ',
        'process-overview-title': '工事の流れ概要',
        'process-overview-desc': '解体工事は複雑な手続きが必要ですが、当社が責任を持って全ての工程を管理いたします。お客様には最小限のご負担で、安心して工事を進めていただけます。',
        
        // Language Selector
        'lang-ja': '日本語',
        'lang-pt': 'Português',
        'lang-en': 'English'
    },
    
    pt: {
        // Navigation
        'nav-home': 'Início',
        'nav-services': 'Serviços',
        'nav-process': 'Processo',
        'nav-gallery': 'Obras',
        'nav-company': 'Empresa',
        'nav-contact': 'Contato',
        
        // Hero Section
        'hero-title': 'Especialista em Demolição em Shonan e Yokohama',
        'hero-subtitle': 'Nikkei Demolição Industrial Ltda.',
        'hero-description': 'Garantimos demolição segura e confiável. Atendemos demolição residencial, pós-incêndio e processamento de resíduos industriais.',
        'hero-cta': 'Orçamento Gratuito',
        
        // Services
        'services-title': 'Nossos Serviços',
        'service-1-title': 'Demolição Residencial',
        'service-1-desc': 'Demolição de casas residenciais',
        'service-2-title': 'Demolição Pós-Incêndio',
        'service-2-desc': 'Demolição de edifícios danificados por incêndio',
        'service-3-title': 'Processamento de Resíduos',
        'service-3-desc': 'Processamento adequado de resíduos industriais',
        'service-4-title': 'Remoção de Carport',
        'service-4-desc': 'Remoção de carports e garagens',
        'service-5-title': 'Remoção de Lixo',
        'service-5-desc': 'Remoção de itens desnecessários e lixo volumoso',
        
        // Process
        'process-title': 'Processo de Demolição',
        'process-description': 'Para detalhes do processo de demolição, consulte',
        'process-link': 'aqui',
        
        // Gallery
        'gallery-title': 'Obras Realizadas',
        'gallery-item-1': 'Demolição Residencial',
        'gallery-item-2': 'Demolição Pós-Incêndio',
        'gallery-item-3': 'Processamento de Resíduos',
        'gallery-item-4': 'Operação de Máquinas',
        'gallery-item-5': 'Limpeza do Local',
        'gallery-item-6': 'Gestão de Segurança',
        
        // Company
        'company-title': 'Sobre a Empresa',
        'company-name': 'Nikkei Demolição Industrial Ltda.',
        'company-phone': '0467-38-8842',
        'company-fax': '0467-38-8843',
        'company-email': 'info@nikkei-kaitai.com',
        'company-license': 'Registro de Empresa de Demolição: Kanagawa (登-29) No.1842 Tóquio (登-30) No.3481',
        
        // Contact
        'contact-title': 'Contato',
        'contact-description': 'Entre em contato conosco',
        'contact-phone': 'Contato por Telefone',
        'contact-form': 'Formulário de Contato',
        
        // Footer
        'footer-services': 'Serviços',
        'footer-areas': 'Áreas de Atuação',
        'footer-company': 'Informações da Empresa',
        'footer-rights': 'Todos os direitos reservados.',
        
        // Process Page
        'process-hero-title': 'Processo de Demolição',
        'process-hero-subtitle': 'Do orçamento à conclusão da obra, em 7 etapas seguras',
        'process-breadcrumb': 'Início > Processo',
        'process-overview-title': 'Visão Geral do Processo',
        'process-overview-desc': 'A demolição requer procedimentos complexos, mas nossa empresa gerencia responsavelmente todos os processos. Garantimos o mínimo de incômodo para nossos clientes.',
        
        // Language Selector
        'lang-ja': '日本語',
        'lang-pt': 'Português',
        'lang-en': 'English'
    },
    
    en: {
        // Navigation
        'nav-home': 'Home',
        'nav-services': 'Services',
        'nav-process': 'Process',
        'nav-gallery': 'Gallery',
        'nav-company': 'Company',
        'nav-contact': 'Contact',
        
        // Hero Section
        'hero-title': 'Demolition Specialist in Shonan & Yokohama',
        'hero-subtitle': 'Nikkei Demolition Industrial Co., Ltd.',
        'hero-description': 'We guarantee safe and reliable demolition work. We handle residential demolition, post-fire demolition, and industrial waste processing.',
        'hero-cta': 'Free Estimate',
        
        // Services
        'services-title': 'Our Services',
        'service-1-title': 'Residential Demolition',
        'service-1-desc': 'House demolition work',
        'service-2-title': 'Post-Fire Demolition',
        'service-2-desc': 'Demolition of fire-damaged buildings',
        'service-3-title': 'Waste Processing',
        'service-3-desc': 'Proper industrial waste processing',
        'service-4-title': 'Carport Removal',
        'service-4-desc': 'Carport and garage removal',
        'service-5-title': 'Waste Removal',
        'service-5-desc': 'Unnecessary items and bulky waste removal',
        
        // Process
        'process-title': 'Demolition Process',
        'process-description': 'For detailed demolition process information, please see',
        'process-link': 'here',
        
        // Gallery
        'gallery-title': 'Construction Sites',
        'gallery-item-1': 'Residential Demolition',
        'gallery-item-2': 'Post-Fire Demolition',
        'gallery-item-3': 'Waste Processing',
        'gallery-item-4': 'Heavy Machinery Operation',
        'gallery-item-5': 'Site Cleanup',
        'gallery-item-6': 'Safety Management',
        
        // Company
        'company-title': 'Company Information',
        'company-name': 'Nikkei Demolition Industrial Co., Ltd.',
        'company-phone': '0467-38-8842',
        'company-fax': '0467-38-8843',
        'company-email': 'info@nikkei-kaitai.com',
        'company-license': 'Demolition Business Registration: Kanagawa (登-29) No.1842 Tokyo (登-30) No.3481',
        
        // Contact
        'contact-title': 'Contact Us',
        'contact-description': 'Please feel free to contact us',
        'contact-phone': 'Phone Contact',
        'contact-form': 'Contact Form',
        
        // Footer
        'footer-services': 'Services',
        'footer-areas': 'Service Areas',
        'footer-company': 'Company Information',
        'footer-rights': 'All rights reserved.',
        
        // Process Page
        'process-hero-title': 'Demolition Process',
        'process-hero-subtitle': 'From estimate to completion, in 7 safe steps',
        'process-breadcrumb': 'Home > Process',
        'process-overview-title': 'Process Overview',
        'process-overview-desc': 'Demolition requires complex procedures, but our company manages all processes responsibly. We ensure minimal inconvenience for our clients.',
        
        // Language Selector
        'lang-ja': '日本語',
        'lang-pt': 'Português',
        'lang-en': 'English'
    }
};

// Language management functions
class LanguageManager {
    constructor() {
        this.currentLanguage = this.getStoredLanguage() || 'ja';
        this.init();
    }
    
    init() {
        this.applyLanguage(this.currentLanguage);
        this.bindEvents();
    }
    
    getStoredLanguage() {
        return localStorage.getItem('selectedLanguage');
    }
    
    setStoredLanguage(lang) {
        localStorage.setItem('selectedLanguage', lang);
    }
    
    createLanguageSelector() {
        console.log('Creating language selector...');
        const navMenu = document.querySelector('.nav-menu');
        console.log('Nav menu found:', navMenu);
        
        if (!navMenu) {
            console.error('Nav menu not found!');
            return;
        }
        
        const languageSelector = document.createElement('li');
        languageSelector.className = 'nav-item language-selector';
        languageSelector.innerHTML = `
            <div class="language-dropdown">
                <button class="language-btn" aria-label="Select Language">
                    <i class="fas fa-globe"></i>
                    <span class="current-lang">${this.getCurrentLanguageName()}</span>
                    <i class="fas fa-chevron-down"></i>
                </button>
                <ul class="language-menu">
                    <li><a href="#" data-lang="ja" class="language-option ${this.currentLanguage === 'ja' ? 'active' : ''}">
                        <span class="flag">🇯🇵</span> ${translations[this.currentLanguage]['lang-ja']}
                    </a></li>
                    <li><a href="#" data-lang="pt" class="language-option ${this.currentLanguage === 'pt' ? 'active' : ''}">
                        <span class="flag">🇧🇷</span> ${translations[this.currentLanguage]['lang-pt']}
                    </a></li>
                    <li><a href="#" data-lang="en" class="language-option ${this.currentLanguage === 'en' ? 'active' : ''}">
                        <span class="flag">🇺🇸</span> ${translations[this.currentLanguage]['lang-en']}
                    </a></li>
                </ul>
            </div>
        `;
        
        navMenu.appendChild(languageSelector);
        console.log('Language selector added to nav menu');
    }
    
    getCurrentLanguageName() {
        const names = {
            'ja': '日本語',
            'pt': 'PT',
            'en': 'EN'
        };
        return names[this.currentLanguage] || '日本語';
    }
    
    bindEvents() {
        // Language selector events
        document.addEventListener('click', (e) => {
            if (e.target.closest('.language-btn')) {
                e.preventDefault();
                const dropdown = e.target.closest('.language-dropdown');
                dropdown.classList.toggle('active');
            }
            
            if (e.target.closest('.language-option')) {
                e.preventDefault();
                const lang = e.target.closest('.language-option').dataset.lang;
                this.changeLanguage(lang);
            }
            
            // Close dropdown when clicking outside
            if (!e.target.closest('.language-dropdown')) {
                document.querySelectorAll('.language-dropdown').forEach(dropdown => {
                    dropdown.classList.remove('active');
                });
            }
        });
    }
    
    changeLanguage(lang) {
        if (lang === this.currentLanguage) return;
        
        this.currentLanguage = lang;
        this.setStoredLanguage(lang);
        this.applyLanguage(lang);
        this.updateLanguageSelector();
        
        // Close dropdown
        document.querySelectorAll('.language-dropdown').forEach(dropdown => {
            dropdown.classList.remove('active');
        });
    }
    
    applyLanguage(lang) {
        const elements = document.querySelectorAll('[data-translate]');
        elements.forEach(element => {
            const key = element.getAttribute('data-translate');
            if (translations[lang] && translations[lang][key]) {
                element.textContent = translations[lang][key];
            }
        });
        
        // Update page title and meta description
        this.updatePageMeta(lang);
    }
    
    updatePageMeta(lang) {
        const titles = {
            'ja': '湘南 横浜の解体工事は日系解体工業株式会社へ',
            'pt': 'Demolição em Shonan e Yokohama - Nikkei Demolição Industrial',
            'en': 'Demolition in Shonan & Yokohama - Nikkei Demolition Industrial'
        };
        
        const descriptions = {
            'ja': '安全で確実な解体工事をお約束します。戸建解体、火事解体、産廃処理まで対応。',
            'pt': 'Garantimos demolição segura e confiável. Atendemos demolição residencial, pós-incêndio e processamento de resíduos.',
            'en': 'We guarantee safe and reliable demolition work. We handle residential demolition, post-fire demolition, and waste processing.'
        };
        
        if (titles[lang]) {
            document.title = titles[lang];
        }
        
        const metaDescription = document.querySelector('meta[name="description"]');
        if (metaDescription && descriptions[lang]) {
            metaDescription.setAttribute('content', descriptions[lang]);
        }
    }
    
    updateLanguageSelector() {
        const currentLangSpan = document.querySelector('.current-lang');
        if (currentLangSpan) {
            currentLangSpan.textContent = this.getCurrentLanguageName();
        }
        
        // Update active state
        document.querySelectorAll('.language-option').forEach(option => {
            option.classList.remove('active');
            if (option.dataset.lang === this.currentLanguage) {
                option.classList.add('active');
            }
        });
    }
}

// Initialize language manager when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing language manager...');
    try {
        new LanguageManager();
        console.log('Language manager initialized successfully');
    } catch (error) {
        console.error('Error initializing language manager:', error);
    }
});

// Fallback initialization if DOMContentLoaded already fired
if (document.readyState === 'loading') {
    // DOM is still loading, wait for DOMContentLoaded
} else {
    // DOM is already loaded
    console.log('DOM already loaded, initializing language manager immediately...');
    try {
        new LanguageManager();
        console.log('Language manager initialized successfully (immediate)');
    } catch (error) {
        console.error('Error initializing language manager (immediate):', error);
    }
}
